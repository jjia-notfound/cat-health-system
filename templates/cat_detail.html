{% extends "base.html" %}

{% block content %}
<div class="row">
    <div class="col-md-8 offset-md-2">
        <h1 class="text-center mb-4">ğŸ± {{ cat_name }} çš„æ¡£æ¡ˆ</h1>
        
        {% if profile %}
        <div class="card mb-4">
            <div class="card-header">
                <h4>åŸºæœ¬ä¿¡æ¯</h4>
            </div>
            <div class="card-body">
                <p><strong>åç§°:</strong> {{ cat_name }}</p>
                <p><strong>åˆ›å»ºæ—¶é—´:</strong> {{ profile.created_date[:10] }}</p>
            </div>
        </div>
        {% endif %}

        <div class="card mb-4">
            <div class="card-header">
                <h4>æ•°æ®ç®¡ç†</h4>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <a href="{{ url_for('upload_data', cat_name=cat_name) }}" 
                           class="btn btn-primary w-100 mb-2">
                            ğŸ“Š ä¸Šä¼ æ•°æ®
                        </a>
                    </div>
                    <div class="col-md-6">
                        <a href="{{ url_for('detect_disease', cat_name=cat_name) }}" 
                           class="btn btn-success w-100 mb-2">
                            ğŸ” å¥åº·æ£€æµ‹
                        </a>
                    </div>
                </div>
            </div>
        </div>

        {% if cat_data is not none %}
        <div class="card mb-4">
            <div class="card-header">
                <h4>æ•°æ®æ¦‚è§ˆ</h4>
            </div>
            <div class="card-body">
                <p><strong>è®°å½•æ¡æ•°:</strong> {{ cat_data.shape[0] if cat_data is not none else 0 }}</p>
                {% if cat_data is not none and not cat_data.empty %}
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>æ—¥æœŸ</th>
                                <th>é¥®æ°´é‡(ml)</th>
                                <th>è¿›é£Ÿé‡(g)</th>
                                <th>æ’å°¿æ¬¡æ•°</th>
                                <th>æ’ä¾¿æ¬¡æ•°</th>
                                <th>å‘•åæ¬¡æ•°</th>
                                <th>è…¹æ³»æ¬¡æ•°</th>
                                <th>ä½“é‡(kg)</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for _, row in cat_data.tail(5).iterrows() %}
                            <tr>
                                <td>{{ row['Date'] }}</td>
                                <td>{{ row['Water(ml)'] }}</td>
                                <td>{{ row['Food(g)'] }}</td>
                                <td>{{ row['Urination'] }}</td>
                                <td>{{ row['Defecation'] }}</td>
                                <td>{{ row['Vomiting'] }}</td>
                                <td>{{ row['Diarrhea'] }}</td>
                                <td>{{ row['Weight(kg)'] }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                <div class="mt-3">
                    <button type="button" class="btn btn-danger" onclick="deleteCatData()">
                        ğŸ—‘ï¸ æ¸…ç©ºæ•°æ®è®°å½•
                    </button>
                </div>
                {% endif %}
            </div>
        </div>
        {% endif %}

        <div class="text-center">
            <a href="{{ url_for('index') }}" class="btn btn-secondary">è¿”å›é¦–é¡µ</a>
            <a href="{{ url_for('view_records', cat_name=cat_name) }}" 
               class="btn btn-info">æŸ¥çœ‹æ£€æµ‹è®°å½•</a>
            <button type="button" class="btn btn-danger" onclick="deleteCat()">
                ğŸ—‘ï¸ åˆ é™¤çŒ«å’ªæ¡£æ¡ˆ
            </button>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function deleteCatData() {
    if (confirm('ç¡®å®šè¦æ¸…ç©ºè¿™åªçŒ«å’ªçš„æ‰€æœ‰æ•°æ®è®°å½•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
        fetch('{{ url_for("delete_data", cat_name=cat_name) }}', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('æ•°æ®è®°å½•å·²æ¸…ç©ºï¼');
                location.reload();
            } else {
                alert('æ“ä½œå¤±è´¥ï¼š' + data.error);
            }
        })
        .catch(error => {
            alert('æ“ä½œå¤±è´¥ï¼š' + error);
        });
    }
}

function deleteCat() {
    if (confirm('ç¡®å®šè¦åˆ é™¤è¿™åªçŒ«å’ªçš„å®Œæ•´æ¡£æ¡ˆå—ï¼Ÿæ­¤æ“ä½œå°†åˆ é™¤çŒ«å’ªçš„æ‰€æœ‰æ•°æ®ã€è®°å½•å’Œæ¡£æ¡ˆä¿¡æ¯ï¼Œä¸å¯æ¢å¤ï¼')) {
        fetch('{{ url_for("delete_cat", cat_name=cat_name) }}', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('çŒ«å’ªæ¡£æ¡ˆå·²åˆ é™¤ï¼');
                window.location.href = '{{ url_for("index") }}';
            } else {
                alert('æ“ä½œå¤±è´¥ï¼š' + data.error);
            }
        })
        .catch(error => {
            alert('æ“ä½œå¤±è´¥ï¼š' + error);
        });
    }
}
</script>
{% endblock %}